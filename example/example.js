!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):t(e.Vue)}(this,function(e){"use strict";function t(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function n(e){return Object.prototype.toString.call(e).match(/\[\w+\s(\w+)\]/)[1].toLowerCase()}function r(e){var t=null;try{t=new s(e)}catch(e){return void alert(e)}l.classList.add("show"),t.on("data",function(n){f.src="string"==typeof e?e:t.img.src,d.value=n.map(function(e){return e.words}).join("\n"),u.classList.add("show"),l.classList.remove("show")})}e=e&&e.hasOwnProperty("default")?e.default:e;var o="https://api.geeku.net/ocr",i={image:"",url:"",language_type:"CHN_ENG",detect_direction:!0,detect_language:!0,probability:!0},a=/https?:\/\/.*?/,s=function(){function e(t){if(this._file=null,this._url="",this.imgReader=new FileReader,this.img=new Image,this.config=null,this.token="",this.eventListeners={},!(this instanceof e))throw new Error("This is not a JsOCR instance.");if(!/image\/(png)|(jpg)|(jpeg)|(bmp)/i.test(t.type))throw new Error("Image format("+t.type+") is not supported. Image format must be PNG, JPG or BMP.");this.config=Object.assign(i);var r=localStorage.getItem("token");this.token=r||"24.2f0d9a3b6a60817dfd94ae61ea6f7e99.2592000.1515124116.282335-10488404";switch(n(t)){case"file":this.file=t;break;case"event":this.file=t.target.files[0];break;case"htmlinputelement":this.addChangeEvent(t);break;case"string":this.url=t;break;default:throw Error("Parament type is illegal.")}}return Object.defineProperty(e.prototype,"file",{get:function(){return this._file},set:function(e){if(e.size>=4194304)throw new Error("Image is oversize.");console.dir(this.file),this._file=e,this.run()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(e){if(!a.test(e))throw new Error("Url format illegal.");this._url=e,this.run("url")},enumerable:!0,configurable:!0}),e.prototype.run=function(e){return void 0===e&&(e="img"),function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function(){var n,r,i,a,s=this;return t(this,function(t){switch(t.label){case 0:return n=null,"img"!==e?[3,2]:[4,this.img2Base64(this._file)];case 1:return n=t.sent(),this.config.image=n.replace(/data:image\/\w+;base64,/,""),this.config.url=void 0,[3,3];case 2:"url"===e&&(this.config.image=void 0,this.config.url=this.url),t.label=3;case 3:return console.log(this.config),r=Object.keys(this.config).filter(function(e){return s.config[e]}).map(function(e){return e+"="+encodeURIComponent(s.config[e])}).join("&"),(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a=fetch(o+"?access_token="+this.token,{method:"POST",headers:i,body:r}).then(function(e){return e.json()}).then(function(e){if(e.error_code)throw new Error("ERROR: "+e.error_code+": "+e.error_msg);s.eventListeners.data&&s.eventListeners.data.forEach(function(t){return t.call(null,e.words_result)}),localStorage&&localStorage.setItem("jsocrHistory",JSON.stringify({img:s.config.url?s.config.url:s.config.image,data:e}))}),[2]}})})},e.prototype.on=function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]},e.prototype.addChangeEvent=function(e){var t=this;e.addEventListener("change",function(e){t.file=e.target.files[0]})},e.prototype.img2Base64=function(e){var t=this;return this.img.crossOrigin="anonymous",new Promise(function(n,r){t.imgReader.onload=function(e){t.img.src=e.target.result,n(e.target.result)},t.imgReader.readAsDataURL(e)})},e}(),c=(new e({el:"main",data:{showContent:!1,showLoading:!1,showAlert:!1,alertMsg:"",token:localStorage.getItem("token")},methods:{clickClose:function(e){this.showContent=!1},upload:function(e){var t=null;try{t=new s(e)}catch(e){return void alert(e)}l.classList.add("show"),t.on("data",function(n){f.src="string"==typeof e?e:t.img.src,d.value=n.map(function(e){return e.words}).join("\n"),u.classList.add("show"),l.classList.remove("show")})},saveToken:function(){localStorage.getItem("token")!==this.token?(localStorage.setItem("token",this.token),this.alert("Token saved.")):this.alert("Nothing change.")},alert:function(e){var t=this;this.showAlert=!0,this.alertMsg=e,window.setTimeout(function(){t.showAlert=!1},3e3)}},computed:{},created:function(){document.addEventListener("paste",function(e){var t=e.clipboardData.getData("text");"file"===n(e.clipboardData.files[0])?r(e.clipboardData.files[0]):a.test(t)&&(console.log(t),r(t))}),document.addEventListener("dragover",function(e){e.preventDefault(),c.classList.add("dragover")}),document.addEventListener("dragleave",function(e){e.preventDefault(),c.classList.remove("dragover")}),document.addEventListener("drop",function(e){e.preventDefault(),r(e.dataTransfer.files[0]),c.classList.remove("dragover")})}}),document.querySelector("body")),l=(document.querySelector(".setting"),document.querySelector(".token"),document.querySelector(".token + button"),document.querySelector("#loading")),u=document.querySelector(".content"),f=u.querySelector("img"),d=u.querySelector("textarea"),h=(u.querySelector(".close"),document.querySelector(".inputField"));h.addEventListener("change",function(e){r(e.target.files[0]),h.value=""})});
