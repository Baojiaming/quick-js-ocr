!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e,t){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function t(e){return Object.prototype.toString.call(e).match(/\[\w+\s(\w+)\]/)[1].toLowerCase()}function n(e){var t=null;try{t=new a(e)}catch(e){return void alert(e)}f.classList.add("show"),t.on("data",function(n){g.src="string"==typeof e?e:t.img.src,h.value=n.map(function(e){return e.words}).join("\n"),d.classList.add("show"),f.classList.remove("show")})}var r="https://api.geeku.net/ocr",o={image:"",url:"",language_type:"CHN_ENG",detect_direction:!0,detect_language:!0,probability:!0},i=/https?:\/\/.*?/,a=function(){function n(e){if(this._file=null,this._url="",this.imgReader=new FileReader,this.img=new Image,this.config=null,this.token="",this.eventListeners={},!(this instanceof n))throw new Error("This is not a JsOCR instance.");if(!/image\/(png)|(jpg)|(jpeg)|(bmp)/i.test(e.type))throw new Error("Image format("+e.type+") is not supported. Image format must be PNG, JPG or BMP.");this.config=Object.assign(o);var r=localStorage.getItem("token");this.token=r||"24.2f0d9a3b6a60817dfd94ae61ea6f7e99.2592000.1515124116.282335-10488404";switch(t(e)){case"file":this.file=e;break;case"event":this.file=e.target.files[0];break;case"htmlinputelement":this.addChangeEvent(e);break;case"string":this.url=e;break;default:throw Error("Parament type is illegal.")}}return Object.defineProperty(n.prototype,"file",{get:function(){return this._file},set:function(e){if(e.size>=4194304)throw new Error("Image is oversize.");console.dir(this.file),this._file=e,this.run()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._url},set:function(e){if(!i.test(e))throw new Error("Url format illegal.");this._url=e,this.run("url")},enumerable:!0,configurable:!0}),n.prototype.run=function(t){return void 0===t&&(t="img"),function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function(){var n,o,i,a,s=this;return e(this,function(e){switch(e.label){case 0:return n=null,"img"!==t?[3,2]:[4,this.img2Base64(this._file)];case 1:return n=e.sent(),this.config.image=n.replace(/data:image\/\w+;base64,/,""),this.config.url=void 0,[3,3];case 2:"url"===t&&(this.config.image=void 0,this.config.url=this.url),e.label=3;case 3:return console.log(this.config),o=Object.keys(this.config).filter(function(e){return s.config[e]}).map(function(e){return e+"="+encodeURIComponent(s.config[e])}).join("&"),(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a=fetch(r+"?access_token="+this.token,{method:"POST",headers:i,body:o}).then(function(e){return e.json()}).then(function(e){if(e.error_code)throw new Error("ERROR: "+e.error_code+": "+e.error_msg);s.eventListeners.data&&s.eventListeners.data.forEach(function(t){return t.call(null,e.words_result)}),localStorage&&localStorage.setItem("jsocrHistory",JSON.stringify({img:s.config.url?s.config.url:s.config.image,data:e}))}),[2]}})})},n.prototype.on=function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]},n.prototype.addChangeEvent=function(e){var t=this;e.addEventListener("change",function(e){t.file=e.target.files[0]})},n.prototype.img2Base64=function(e){var t=this;return this.img.crossOrigin="anonymous",new Promise(function(n,r){t.imgReader.onload=function(e){t.img.src=e.target.result,n(e.target.result)},t.imgReader.readAsDataURL(e)})},n}(),s=document.querySelector("body"),c=document.querySelector(".setting"),l=document.querySelector(".token"),u=document.querySelector(".token + button"),f=document.querySelector("#loading"),d=document.querySelector(".content"),g=d.querySelector("img"),h=d.querySelector("textarea");d.querySelector(".close").addEventListener("click",function(e){e.stopPropagation(),d.classList.remove("show")}),c.addEventListener("click",function(e){e.stopPropagation()}),u.addEventListener("click",function(e){var t=l.value;l?(localStorage.setItem("token",t),alert("Token saved.")):alert("Token cannot be empty.")});var p=localStorage.getItem("token");p&&(l.value=p);var m=document.querySelector(".inputField");m.addEventListener("change",function(e){n(e.target.files[0]),m.value=""}),document.addEventListener("paste",function(e){var r=e.clipboardData.getData("text");"file"===t(e.clipboardData.files[0])?n(e.clipboardData.files[0]):i.test(r)&&(console.log(r),n(r))}),document.addEventListener("dragover",function(e){e.preventDefault(),s.classList.add("dragover")}),document.addEventListener("dragleave",function(e){e.preventDefault(),s.classList.remove("dragover")}),document.addEventListener("drop",function(e){e.preventDefault(),n(e.dataTransfer.files[0]),s.classList.remove("dragover")})});
